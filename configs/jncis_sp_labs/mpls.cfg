R1:
set interfaces lt-0/0/0 unit 13 family mpls
set interfaces lo0 unit 2 family mpls
set protocols mpls interface lt-0/0/0.13
set protocols mpls interface lo0.1
set protocols ldp interface lt-0/0/0.13
set protocols ldp interface lo0.1

set routing-options autonomous-system 65000
set routing-options router-id 192.168.1.1
set protocols bgp group external type external
set protocols bgp group external peer-as 65530
set protocols bgp group external neighbor 10.0.1.2

set protocols bgp group internal type internal
set protocols bgp group internal local-address 192.168.1.1
set protocols bgp group internal neighbor 192.168.1.3
set protocols bgp group internal export nhs

set policy-options policy-statement nhs from protocol bgp
set policy-options policy-statement nhs from external
set policy-options policy-statement nhs then next-hop self

XR1:
set routing-options autonomous-system 65530
set routing-options router-id 192.168.1.7
set protocols bgp group external type external
set protocols bgp group external peer-as 65000
set protocols bgp group external neighbor 10.0.1.3
set protocols bgp group external export loop-to-bgp

set policy-options policy-statement loop-to-bgp from route-filter 192.168.1.7/32 exact
set policy-options policy-statement loop-to-bgp then accept


R2:
set interfaces lt-0/0/0 unit 23 family mpls
set interfaces lo0 unit 2 family mpls
set protocols mpls interface lt-0/0/0.23
delete protocols mpls interface lt-0/0/0.32
set protocols mpls interface lo0.2
delete protocols ldp interface lt-0/0/0.32
set protocols ldp interface lt-0/0/0.23
set protocols ldp interface lo0.2

set routing-options autonomous-system 65000
set routing-options router-id 192.168.1.2
set protocols bgp group external type external
set protocols bgp group external peer-as 65531
set protocols bgp group external neighbor 10.0.1.5

set protocols bgp group internal type internal
set protocols bgp group internal local-address 192.168.1.2
set protocols bgp group internal neighbor 192.168.1.3
set protocols bgp group internal export nhs

set policy-options policy-statement nhs from protocol bgp
set policy-options policy-statement nhs from external
set policy-options policy-statement nhs then next-hop self

XR2:
set routing-options autonomous-system 65531
set routing-options router-id 192.168.1.8
set protocols bgp group external type external
set protocols bgp group external peer-as 65000
set protocols bgp group external neighbor 10.0.1.4
set protocols bgp group external export loop-to-bgp

set policy-options policy-statement loop-to-bgp from route-filter 192.168.1.8/32 exact
set policy-options policy-statement loop-to-bgp then accept

R3:
set routing-options autonomous-system 65000
set routing-options router-id 192.168.1.3

set protocols bgp group internal type internal
set protocols bgp group internal local-address 192.168.1.3
set protocols bgp group internal neighbor 192.168.1.1
set protocols bgp group internal neighbor 192.168.1.2
set protocols bgp group internal neighbor 192.168.1.6
set protocols bgp group internal cluster 192.168.1.3

R5:
set interfaces lt-0/0/0 unit 53 family mpls
set interfaces lt-0/0/0 unit 56 family mpls
set interfaces lo0 unit 5 family mpls
set protocols mpls interface lt-0/0/0.53
set protocols mpls interface lt-0/0/0.56
set protocols mpls interface lo0.5
set protocols ldp interface lt-0/0/0.53
set protocols ldp interface lt-0/0/0.56
set protocols ldp interface lo0.5

R6:
set routing-options autonomous-system 65000
set routing-options router-id 192.168.1.6
set protocols bgp group external type external
set protocols bgp group external peer-as 65532
set protocols bgp group external neighbor 10.0.1.7

set protocols bgp group internal type internal
set protocols bgp group internal local-address 192.168.1.6
set protocols bgp group internal neighbor 192.168.1.3
set protocols bgp group internal export nhs

set policy-options policy-statement nhs from protocol bgp
set policy-options policy-statement nhs from external
set policy-options policy-statement nhs then next-hop self

XR3:
set routing-options autonomous-system 65532
set routing-options router-id 192.168.1.9
set protocols bgp group external type external
set protocols bgp group external peer-as 65000
set protocols bgp group external neighbor 10.0.1.6
set protocols bgp group external export loop-to-bgp

set policy-options policy-statement loop-to-bgp from route-filter 192.168.1.9/32 exact
set policy-options policy-statement loop-to-bgp then accept